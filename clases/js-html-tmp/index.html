<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@2/css/pico.min.css">
    <title>Agenda</title>
    <script src="index.js"></script>
</head>
<body>
    <nav>
  <ul><li><strong>Agenda</strong></li>
  <ul>
    <li>
        <input id="buscar" type="search" name="buscar" placeholder="Ingrese el texto a buscar" value=""/>
    </li>
    <li>
        <button id="agregar" class="secondary">Agregar</button>
    </li>
  </ul>
</nav>
<dialog id="dialogo">
    <form id="formulario">
        <article>
            <header>Agregar Contacto</header>
            <input type="hidden" name="id" />
            <fieldset class="grid">
                <label> Nombre: 
                    <input name="nombre" placeholder="Ingrese el Nombre" />
                </label>
                <label>Apellido: 
                    <input name="apellido" placeholder="Ingrese el Apellido" />
                </label>
            </fieldset>
        <fieldset class="grid">
            <label>Teléfono: 
                <input name="telefono" placeholder="Ingrese el Teléfono" />
            </label>
            <label>Email: 
                <input name="email" placeholder="Ingrese el Email" />
            </label>
        </fieldset>
        <fieldset class="grid">
            <button id="aceptar"  type="submit">Aceptar</button>
            <button id="cancelar" type="reset">Cancelar</button>
        </fieldset>
        </article>
    </form>
</dialog>
<main id="agenda" class="grid" style="grid-template-columns: repeat(3, 1fr); gap: 1rem;">
    
</main>
<script>
    let $ = (selector) => document.querySelector(selector);
    $("#agregar").onclick = () => { const f = $("#formulario"); f.reset(); f.elements["id"].value = ""; $("#dialogo").showModal(); };
    $("#formulario").addEventListener("submit", (ev) => {
        ev.preventDefault(); // evita recargar la página
        const f = ev.currentTarget;
        const contacto = {
            id: f.elements["id"].value,
            nombre: f.elements["nombre"].value,
            apellido: f.elements["apellido"].value,
            telefono: f.elements["telefono"].value,
            email: f.elements["email"].value
        };
        agenda.actualizar(new Contacto(contacto));
        $("#dialogo").close();
        f.reset();
        GenerarAgenda();
    });
    $("#cancelar").onclick = () => $("#dialogo").close();
    $("#buscar").oninput = GenerarAgenda;

    function editar(id){
        let contacto = agenda.traer(+id);
        let f = $("#formulario");
        f.elements["nombre"].value = contacto.nombre;
        f.elements["apellido"].value = contacto.apellido;
        f.elements["telefono"].value = contacto.telefono;
        f.elements["email"].value = contacto.email;
        f.elements["id"].value = contacto.id;
        $("#dialogo").showModal();
    }

    function GenerarContacto({id, nombre, apellido, telefono, email}){
        return `
        <article>
            <header>${nombre} ${apellido}</header>
            <p>Tel: ${telefono}</p>
            <p>Email: ${email}</p>
            <button onclick="editar(${id})">Editar</button>
        </article>`;
    }

    function GenerarAgenda(){
        let html = "";
        let filtro = $("#buscar").value;

        for(let contacto of agenda.traerTodos(filtro)){
            html += GenerarContacto(contacto);
        }
        $("#agenda").innerHTML = html;
    }
    
    GenerarAgenda();
</script>
</body>
</html>